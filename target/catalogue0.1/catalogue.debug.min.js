(function(){var a;this.Catalogue=a={},a.VERSION="0.1",a.Config||(a.Config={}),a.Node||(a.Node={}),a.Node.Areas=".catalogue-toolbar select",a.Node.Search=".catalogue-toolbar input",a.Node.SearchButton=".catalogue-toolbar button",a.Node.Queries=".catalogue-queries",a.Node.Facets=".catalogue-facets",a.Node.Content=".catalogue-content",a.Node.Results=".catalogue-content .catalogue-results",a.Node.Pagination=".catalogue-content .pagination"}).call(this),function(){Catalogue.Core=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;return console.log(":: Core"),c=["All the Catalogue","Articles","Documents","News","Links","Sites","Habitats","Species"],h=function(){return f(),e()},d=function(){return"http://"+a.Config.host+"/api/v1/search"},f=function(){var d,e,f,g,h,i,j,k;for(i=b("<div>").addClass("catalogue-toolbar"),f=b("<div>").addClass("areas"),e=b("<select>"),h=j=0,k=c.length;k>j;h=++j)d=c[h],e.append(b("<option>").html(c[h]));return i.append(f.append(e)),g='<form class="form-search"><input id="query" name="query" type="text" class="input-medium search-query"><button type="submit" class="btn">Search</button></form>',i.append(g),$(a.Config.node).append(i),b(".catalogue-toolbar form").on("submit",function(c){return c.preventDefault(),a.Search.addQuery(""+b(".catalogue-toolbar input").val()),b(".catalogue-toolbar input").val("")})},e=function(){var c,d,e;return c=b("<div>").addClass("catalogue-container"),e=b("<div>").addClass("catalogue-sidebar span3"),e.append(b("<div>").addClass("catalogue-queries")),e.append(b("<div>").addClass("catalogue-facets")),d=b("<div>").addClass("catalogue-content span9"),d.append(b("<ul>").addClass("catalogue-results")),d.append(b("<div>").addClass("pagination")),c.append(e).append(d),$(a.Config.node).append(c)},l=function(b){return b?$(a.Node.Queries).show():$(a.Node.Queries).hide()},k=function(b){return b?$(a.Node.Facets).show():$(a.Node.Facets).hide()},g=function(){return $(a.Node.Queries).fade(),$(a.Node.Facets).fade()},j=function(c){var d,e,f,g;for(b(a.Node.Results).html(""),g=[],e=0,f=c.length;f>e;e++)d=c[e],g.push(b(a.Node.Results).append(i(d)));return g},i=function(a){var c,d;switch(a._type){case"article":return c='<div class="article_cell"><div class="cell-title"><a href="{{url}}">{{title}}</a></div><small><strong>By:</strong>{{author}}</small></div>',d={title:a.title,url:"#",author:a.author},b("<li>").append(Catalogue.Core.tmpl(c)(d));case"document":return c='<div class="document_cell"><div class="pull-left mini-icon"></div><div class="cell-title"><a href="{{url}}">{{title}}</a></div><small><strong>By:</strong>{{author}}</small></div>',d={title:a.title,url:"#",author:a.author},b("<li>").append(Catalogue.Core.tmpl(c)(d));case"new":return c="";case"link":return c="";case"protected_area":return c="";case"habitats":return c="";case"species":return c='<div class="species_cell"><div class="cell-title"><a href="http://eunis.eea.europa.eu/species/{{url}}">{{name}}</a></div><small><strong>Authorship:</strong>{{authorship}}</div>',d={name:a.binomial_name,url:a.id,author:a.author},b("<li>").append(Catalogue.Core.tmpl(c)(d))}},m=function(a){var c,d,e,f;return d=function(a,b){var c,d,e;for(b=1,a=a.replace(/\.\.\//g,function(){return b++,""}),d=["vars[vars.length - ",b,"]"],e="."===a?[]:a.split("."),c=0;e.length>c;)d.push("."+e[c]),c++;return d.join("")},f=function(a){return a.replace(/\{\{(!|&|\{)?\s*(.*?)\s*}}+/g,function(a,b,c){var f;return"!"===b?"":(f=e++,['"; var o',f," = ",d(c),", s",f," = (((typeof(o",f,') == "function" ? o',f,".call(vars[vars.length - 1]) : o",f,') || "") + ""); s += ',b?"s"+f:'(/[&"><]/.test(s'+f+") ? s"+f+'.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/>/g,"&gt;").replace(/</g,"&lt;") : s'+f+")",' + "'].join(""))})},c=function(a){return f(a.replace(/\{\{(\^|#)(.*?)}}(.*?)\{\{\/\2}}/g,function(a,b,f,g){var h;return h=e++,['"; var o',h," = ",d(f),"; ",("^"===b?["if ((o",h," instanceof Array) ? !o",h,".length : !o",h,') { s += "',c(g),'"; } ']:["if (typeof(o",h,') == "boolean" && o',h,') { s += "',c(g),'"; } else if (o',h,") { for (var i",h," = 0; i",h," < o",h,".length; i",h,"++) { vars.push(o",h,"[i",h,']); s += "',c(g),'"; vars.pop(); }}']).join(""),'; s += "'].join("")}))},e=0,Function("vars",'vars = [vars], s = "'+c(a.replace(/"/g,'\\"').replace(/\n/g,"\\n"))+'"; return s;')},{init:h,connection:d,tmpl:m,render:i,renderAll:j,showQueriesPane:l,showFacetsPane:k,hideSidebar:g}}(Catalogue,jQuery)}.call(this),function(){Catalogue.Facet=function(){return console.log(":: Facet")}(Catalogue)}.call(this),function(){Catalogue.Search=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return r=null,q=10,o=1,t=0,n={},s=[],p={},c=function(a){return""!==a&&(r=a,p={}),k()},m=function(){return r=null,b(a.Node.Queries).html("").hide(),b(a.Node.Facets).html("").hide(),b(a.Node.Results).html("").hide(),b(a.Node.Pagination).hide(),k()},i=function(a,b){return p.hasOwnProperty(a)?p[a]===b?delete p[a]:(p[a]=b,o=1):(p[a]=b,o=1),k()},l=function(a){return delete p[a],k()},j=function(){var a;return p.query=r,p.page=o,p.per=q,a=Object.keys(n),p},k=function(){return r?(console.log(j()),$.ajax({type:"GET",url:a.Core.connection(),context:document.body,data:j()}).done(function(a){return t=a.total,n=a.facets,s=a.results,f(),d(),g(),e()}).error(function(){return a.Search.total=0,a.Search.facets={},a.Search.results=[]})):void 0},h=function(a){return o=a},f=function(){var c,d,e,f,g,h,i,j;for(b(a.Node.Queries).html(""),h=b("<ul>"),f=b("<li>"),c=b("<span>").addClass("close").html("&#10006;"),c.attr("data-query",r),c.click(function(){return m(b(this).data("query")),b(this).parent().remove()}),f.append(c).append(r),h.append(f),e=Object.keys(n),i=0,j=e.length;j>i;i++)d=e[i],p[d]&&(f=b("<li>").html(d+": "+p[d]),c=b("<span>").addClass("close").html("&#10006;"),c.attr("data-facet",d).attr("data-value",p[d]),c.click(function(){return l(b(this).data("facet"),b(this).data("value")),b(this).parent().remove()}),f.append(c),h.append(f));return b(a.Node.Queries).append(h),g=b("<small>").html("About "+t+" results"),b(a.Node.Queries).append(g),b(a.Node.Queries).show()},d=function(){var c,d,e,f,g,h,j,k,l,m,o,q,r;for(g=Object.keys(n),b(a.Node.Facets).html(""),l=0,o=g.length;o>l;l++)if(f=g[l],!p[f]){if(e=b("<div>"),d=n[f],j=f.toUpperCase(),d.terms&&d.terms.length>0){for(e.append(b("<legend>").html(j)),k=b("<ul>"),r=d.terms,m=0,q=r.length;q>m;m++)h=r[m],c=b('<a href="#">').html(h.term),c.attr("data-facet",f).attr("data-value",h.term),c.click(function(){return i($(this).data("facet"),$(this).data("value"))}),k.append(b("<li>").append(c));e.append(k)}b(a.Node.Facets).append(e)}return b(a.Node.Facets).show()},g=function(){return Catalogue.Core.renderAll(s),b(a.Node.Results).show()},e=function(){var c;return $(a.Node.Pagination).pagination("destroy"),c=Math.ceil(t/q),b(a.Node.Pagination).pagination({items:t,itemsOnPage:q,currentPage:o,cssStyle:"compact-theme"})},{addQuery:c,removeQuery:m,query:k,goPage:h}}(Catalogue,jQuery)}.call(this),function(){(function(a){var b;return b={init:function(c){var d,e;return d=a.extend({items:1,itemsOnPage:1,pages:0,displayedPages:5,edges:2,currentPage:1,hrefTextPrefix:"#page-",hrefTextSuffix:"",prevText:"Prev",nextText:"Next",ellipseText:"&hellip;",cssStyle:"light-theme",selectOnClick:!0,onPageClick:function(a){return console.log(a),Catalogue.Search.goPage(a),Catalogue.Search.query()},onInit:function(){}},c||{}),e=this,d.pages=d.pages?d.pages:Math.ceil(d.items/d.itemsOnPage)?Math.ceil(d.items/d.itemsOnPage):1,d.currentPage=d.currentPage-1,d.halfDisplayed=d.displayedPages/2,this.each(function(){return e.addClass(d.cssStyle+" simple-pagination").data("pagination",d),b._draw.call(e)}),d.onInit(),this},selectPage:function(a){return b._selectPage.call(this,a-1),this},prevPage:function(){var a;return a=this.data("pagination"),a.currentPage>0&&b._selectPage.call(this,a.currentPage-1),this},nextPage:function(){var a;return a=this.data("pagination"),a.currentPage<a.pages-1&&b._selectPage.call(this,a.currentPage+1),this},getPagesCount:function(){return this.data("pagination").pages},getCurrentPage:function(){return this.data("pagination").currentPage+1},destroy:function(){return this.empty(),this},redraw:function(){return b._draw.call(this),this},disable:function(){var a;return a=this.data("pagination"),a.disabled=!0,this.data("pagination",a),b._draw.call(this),this},enable:function(){var a;return a=this.data("pagination"),a.disabled=!1,this.data("pagination",a),b._draw.call(this),this},_draw:function(){var c,d,e,f,g,h;if(h=this.data("pagination"),g=b._getInterval(h),f=void 0,b.destroy.call(this),c="UL"===this.prop("tagName")?this:a("<ul></ul>").appendTo(this),h.prevText&&b._appendItem.call(this,h.currentPage-1,{text:h.prevText,classes:"prev"}),g.start>0&&h.edges>0){for(e=Math.min(h.edges,g.start),f=0;e>f;)b._appendItem.call(this,f),f++;h.edges<g.start&&1!==g.start-h.edges?c.append('<li class="disabled"><span class="ellipse">'+h.ellipseText+"</span></li>"):1===g.start-h.edges&&b._appendItem.call(this,h.edges)}for(f=g.start;g.end>f;)b._appendItem.call(this,f),f++;if(g.end<h.pages&&h.edges>0)for(h.pages-h.edges>g.end&&1!==h.pages-h.edges-g.end?c.append('<li class="disabled"><span class="ellipse">'+h.ellipseText+"</span></li>"):1===h.pages-h.edges-g.end&&b._appendItem.call(this,g.end++),d=Math.max(h.pages-h.edges,g.end),f=d;h.pages>f;)b._appendItem.call(this,f),f++;return h.nextText?b._appendItem.call(this,h.currentPage+1,{text:h.nextText,classes:"next"}):void 0},_getInterval:function(a){return{start:Math.ceil(a.currentPage>a.halfDisplayed?Math.max(Math.min(a.currentPage-a.halfDisplayed,a.pages-a.displayedPages),0):0),end:Math.ceil(a.currentPage>a.halfDisplayed?Math.min(a.currentPage+a.halfDisplayed,a.pages):Math.min(a.displayedPages,a.pages))}},_appendItem:function(c,d){var e,f,g,h,i,j;return j=this,i=void 0,e=void 0,h=j.data("pagination"),f=a("<li></li>"),g=j.find("ul"),c=0>c?0:h.pages>c?c:h.pages-1,i=a.extend({text:c+1,classes:""},d||{}),c===h.currentPage||h.disabled?(h.disabled?f.addClass("disabled"):f.addClass("active"),e=a('<span class="current">'+i.text+"</span>")):(e=a('<a href="'+h.hrefTextPrefix+(c+1)+h.hrefTextSuffix+'" class="page-link">'+i.text+"</a>"),e.click(function(a){return b._selectPage.call(j,c,a)})),i.classes&&e.addClass(i.classes),f.append(e),g.length?g.append(f):j.append(f)},_selectPage:function(a,c){var d;return d=this.data("pagination"),d.currentPage=a,d.selectOnClick&&b._draw.call(this),d.onPageClick(a+1,c)}},a.fn.pagination=function(c){return b[c]&&"_"!==c.charAt(0)?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?a.error("Method "+c+" does not exist on jQuery.pagination"):b.init.apply(this,arguments)}})(jQuery)}.call(this),function(){Catalogue.init=function(a){return Catalogue.Config=a,Catalogue.Core.init()}}.call(this);
